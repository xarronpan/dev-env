"plugin settings
let NERDTreeQuitOnOpen=0
let g:ackprg = 'ag --nogroup --nocolor --column'
let g:indent_guides_enable_on_vim_startup = 0
let g:signify_priority = 5
let g:airline#extensions#ycm#enabled = 1
let g:airline#extensions#ycm#error_symbol = 'E:'
let g:airline#extensions#ycm#warning_symbol = 'W:'
let g:ycm_always_populate_location_list = 1
highlight ycmwarningline guibg=#ffffcc
highlight ycmwarningsign guibg=#ffffcc
highlight ycmwarningsection guibg=#ffffcc
let g:ycm_auto_hover = ''
let g:ycm_key_invoke_completion = '<c-a>'
noremap <c-a> <NOP>
let g:comfortable_motion_no_default_key_mappings = 1
let g:gutentags_ctags_executable = 'ctags-universal'
let g:asyncrun_open = 8
let g:indent_guides_auto_colors = 0
autocmd VimEnter,Colorscheme * :hi IndentGuidesOdd   ctermbg=Black
autocmd VimEnter,Colorscheme * :hi IndentGuidesEven  ctermbg=Black
let g:cpp_class_scope_highlight = 1
let cpp_no_cpp14 = 1
let cpp_no_cpp17 = 1
let cpp_no_cpp20 = 1
let g:protodefprotogetter = '~/.vim/bundle/vim-protodef/pullproto.pl'
let g:disable_protodef_sorting = 1
let g:rainbow_conf = {
\   'separately': {
\       'cmake': 0,
\   },
\}
let g:winresizer_start_key = '<C-Z>'
let g:go_def_mapping_enabled = 0
let g:go_highlight_function_calls = 1
let g:go_highlight_types = 1
let g:go_highlight_fields = 1
let g:go_list_height = 10
let g:far#source = 'ag'
let g:far#enable_undo = 1
let g:context_enabled = 0
let g:context_add_mappings = 0
let g:nrrw_rgn_incr = 60
let g:nrrw_rgn_hl = 'Search'
let g:VtrClearBeforeSend = 0
let g:NERDTreeGitStatusIndicatorMapCustom = {
                \ 'Modified'  :'m',
                \ 'Staged'    :'+',
                \ 'Untracked' :'?',
                \ 'Renamed'   :'r',
                \ 'Unmerged'  :'!',
                \ 'Deleted'   :'-',
                \ 'Dirty'     :'d',
                \ 'Ignored'   :'.',
                \ 'Clean'     :'c',
                \ 'Unknown'   :'#'}

"vim setting configure
set ttymouse=xterm2
set expandtab softtabstop=2 tabstop=2 shiftwidth=2
set undodir=~/.vim/undodir
set undofile
set showcmd
let g:solarized_termcolors=16
color solarized
autocmd BufEnter *.go call timer_start(10, { tid -> execute('setlocal nolist') })
autocmd BufEnter * call timer_start(10, { tid -> execute('setlocal nospell') })

function! s:p(...)
  let preview_args = get(g:, 'fzf_preview_window', ['right', 'ctrl-/'])
  if empty(preview_args)
    return { 'options': ['--preview-window', 'hidden'] }
  endif

  " For backward-compatiblity
  if type(preview_args) == type('')
    let preview_args = [preview_args]
  endif
  return call('fzf#vim#with_preview', extend(copy(a:000), preview_args))
endfunction

"fix alt key mapping
function! Terminal_MetaMode(mode)
  set ttimeout
  if $TMUX != ''
    set ttimeoutlen=30
  elseif &ttimeoutlen > 80 || &ttimeoutlen <= 0
    set ttimeoutlen=80
  endif
  if has('nvim') || has('gui_running')
    return
  endif
  function! s:metacode(mode, key)
    if a:mode == 0
        exec "set <M-".a:key.">=\e".a:key
    else
        exec "set <M-".a:key.">=\e]{0}".a:key."~"
    endif
  endfunc
  for i in range(10)
    call s:metacode(a:mode, nr2char(char2nr('0') + i))
  endfor
  for i in range(26)
    call s:metacode(a:mode, nr2char(char2nr('a') + i))
    call s:metacode(a:mode, nr2char(char2nr('A') + i))
  endfor
  if a:mode != 0
    for c in [',', '.', '/', ';', '[', ']', '{', '}']
      call s:metacode(a:mode, c)
    endfor
    for c in ['?', ':', '-', '_']
      call s:metacode(a:mode, c)
    endfor
  else
    for c in [',', '.', '/', ';', '{', '}']
      call s:metacode(a:mode, c)
    endfor
    for c in ['?', ':', '-', '_']
      call s:metacode(a:mode, c)
    endfor
  endif
endfunc


"abbrevate command configure
command! -bang -nargs=* CWAg call fzf#vim#ag(expand('<cword>'),s:p(),<bang>0)
command! -bang -nargs=* CWBLines
      \ call fzf#vim#buffer_lines(expand('<cword>'),
      \     fzf_preview#p(<bang>0, {'placeholder': fzf#shellescape(expand('%')) . ':{1}',
      \                 'options': '--preview-window +{1}-/2'}),
      \     <bang>0)

command! -bang -nargs=* FSFZFBLines
      \ call fzf#vim#buffer_lines(<q-args>,
      \     fzf_preview#p(<bang>0, {'placeholder': fzf#shellescape(expand('%')) . ':{1}',
      \                 'options': '--preview-window +{1}-/2'}),
      \     <bang>0)

cnoreabbrev GAck Gcd <bar> Ack!
cnoreabbrev GAg Gcd <bar> Ag!
cnoreabbrev RO bdelete <bar> edit #
cnoreabbrev BL FSFZFBLines!
cnoreabbrev AR AsyncRun
cnoreabbrev TR VtrSendCommandToRunner!
cnoreabbrev TRL VtrSendLinesToRunner!
cnoreabbrev TA VtrAttachToPane
cnoreabbrev BM Bookmark
cnoreabbrev EBM EditBookmarks
cnoreabbrev TL Translate
cnoreabbrev YR YcmCompleter RefactorRename
cnoreabbrev YF YcmCompleter Format
cnoreabbrev CT ContextToggle
cnoreabbrev LD Linediff
"add slash
cnoreabbrev AS s/$/\//
"add back slash
cnoreabbrev ABS s/$/\\/
"remove trailing space
cnoreabbrev RTS s/\v[ ]+$//

"key mappings configure
let mapleader = ","
inoremap jj <Esc>
call Terminal_MetaMode(0)
nnoremap <leader>lo :lopen<CR>
nnoremap <leader>lc :lclose<CR>
nnoremap <leader>lp :FZFLocList!<CR>
nnoremap <leader>qo :copen<CR>
nnoremap <leader>qc :cclose<CR>
nnoremap <leader>qp :FZFQuickFix!<CR>
nnoremap <leader>gd :YcmCompleter GoTo<CR>
nnoremap <leader>gr :YcmCompleter GoToReferences<CR>:q<CR>:copen<CR>
nnoremap <leader>fi :YcmCompleter FixIt<CR>
nnoremap <leader>gi :YcmCompleter GoToImplementation<CR>
nnoremap <leader>gt :YcmCompleter GoToType<CR>
nnoremap <leader>et :YcmCompleter GetType<CR>
nnoremap <leader>do :YcmCompleter GetDoc<CR>
nnoremap <silent> <C-f> :GFiles<CR>
nnoremap <silent> <C-t> :BTags<CR>
nnoremap <silent> <C-g> :Gcd <bar> CWAg!<CR>
nnoremap <silent> <C-l> :CWBLines!<CR>
nnoremap <silent> <C-h> :History<CR>
nnoremap <silent> <C-c> :Commands<CR>
nnoremap <leader>h: :History:<CR>
nnoremap <leader>h/ :History/<CR>
nmap <leader><tab> <plug>(fzf-maps-n)
xmap <leader><tab> <plug>(fzf-maps-x)
omap <leader><tab> <plug>(fzf-maps-o)
imap <c-x><c-k> <plug>(fzf-complete-word)
imap <c-x><c-f> <plug>(fzf-complete-path)
imap <c-x><c-l> <plug>(fzf-complete-line)
inoremap <expr> <c-x><c-r> fzf#vim#complete('cat ~/.zsh_history\|cut -c 16-\|tac')
nmap s <Plug>(easymotion-s)
nnoremap <silent> <C-d> :call comfortable_motion#flick(100)<CR>
nnoremap <silent> <C-u> :call comfortable_motion#flick(-100)<CR>
nnoremap <leader>zfs :set foldmethod=syntax<CR>
nnoremap <leader>zfi :set foldmethod=indent<CR>
map <C-e> :Gcd <bar> NERDTreeTabsToggle<CR>
nmap <leader>nt :Gcd <bar> NERDTreeFind<CR>
nnoremap <leader>pt :PreviewTag<CR>
nnoremap <leader>pc :PreviewClose<CR>
au FileType go nmap <Leader>gd :YcmCompleter GoTo<CR>
au FileType go nmap <leader>goi <Plug>(go-implements)
au FileType go nmap <leader>god <Plug>(go-describe)

if filereadable("./.workspace.vim")
   source ./.workspace.vim
endif
